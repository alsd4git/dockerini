# Home Dashboard & Monitoring Stack
# This stack provides tools for home monitoring, dashboard management, and system metrics visualization.
#
# Note: Both mapped and exposed ports are documented. The long-term plan is to reduce direct port exposure in favor of reverse proxying for internal services.
#
# Required environment variables:
# - DOCKER_DATA_BASEFOLDER: Base directory for persistent data
# - DOCKER_MEDIA_BASEFOLDER: Base directory for media files

services:
  dash:
    image: mauricenino/dashdot:latest
    container_name: dashdot
    restart: unless-stopped
    privileged: true
    ports:
      - 3002:3001 # Web UI (external mapping)
    expose:
      - 3001 # Web UI (internal, for reverse proxy or internal access)
    environment:
      - DASHDOT_SHOW_HOST=true
      - DASHDOT_SHOW_DASH_VERSION=true
      - DASHDOT_ENABLE_CPU_TEMPS=true
      - DASHDOT_ALWAYS_SHOW_PERCENTAGES=true
    volumes:
      - /:/mnt/host:ro
    networks:
      - monitoring_network

  dozzle:
    image: amir20/dozzle:latest
    container_name: dozzle
    restart: always
    ports:
      - 8081:8080 # Web UI (external mapping)
    expose:
      - 8080 # Web UI (internal, for reverse proxy or internal access)
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - monitoring_network

  glances:
    image: nicolargo/glances:latest-full
    container_name: glances
    restart: always
    ports:
      - 61208:61208 # Web UI/API (external mapping)
    expose:
      - 61208 # Web UI/API (internal, for reverse proxy or internal access)
    pid: host
    volumes:
      - /etc/os-release:/etc/os-release:ro
      - /home:/fs/home:ro
      - ${DOCKER_MEDIA_BASEFOLDER:-/opt/docker/media}:/fs/media:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ${DOCKER_DATA_BASEFOLDER:-/opt/docker/data}/glances/glances.conf:/etc/glances.conf
    environment:
      - GLANCES_OPT=-w
    networks:
      - monitoring_network

  homeassistant:
    image: linuxserver/homeassistant:latest
    container_name: homeassistant
    restart: unless-stopped
    network_mode: host
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Rome
      - DOCKER_MODS=linuxserver/mods:homeassistant-hacs
    cap_add:
      - NET_ADMIN
      - NET_RAW
    volumes:
      - ${DOCKER_DATA_BASEFOLDER:-/opt/docker/data}/homeassistant/config:/config
      - /run/dbus:/run/dbus:ro
    ports:
      - 8123:8123 # Web UI (external mapping)
    expose:
      - 8123 # Web UI (internal, for reverse proxy or internal access)

  homepage:
    image: ghcr.io/gethomepage/homepage:latest
    container_name: homepage
    restart: unless-stopped
    ports:
      - 3001:3000 # Web UI (external mapping)
    expose:
      - 3000 # Web UI (internal, for reverse proxy or internal access)
    volumes:
      - ${DOCKER_DATA_BASEFOLDER:-/opt/docker/data}/homepage/config:/app/config
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - monitoring_network

  homebox:
    image: ghcr.io/sysadminsmedia/homebox:latest-rootless
    container_name: homebox
    restart: always
    ports:
      - 3100:7745 # Web UI (external mapping)
    expose:
      - 7745 # Web UI (internal, for reverse proxy or internal access)
    environment:
      - HBOX_LOG_LEVEL=info
      - HBOX_LOG_FORMAT=text
      - HBOX_WEB_MAX_UPLOAD_SIZE=10
      - HBOX_OPTIONS_ALLOW_REGISTRATION=false
    volumes:
      - ${DOCKER_DATA_BASEFOLDER:-/opt/docker/data}/homebox:/data
    user: "1000:1000"
    networks:
      - monitoring_network

  homarr:
    image: ghcr.io/ajnart/homarr:latest
    container_name: homarr
    restart: unless-stopped
    ports:
      - 7575:7575 # Web UI (external mapping)
    expose:
      - 7575 # Web UI (internal, for reverse proxy or internal access)
    volumes:
      - ${DOCKER_DATA_BASEFOLDER:-/opt/docker/data}/homarr/configs:/app/data/configs
      - ${DOCKER_DATA_BASEFOLDER:-/opt/docker/data}/homarr/icons:/app/public/icons
      - ${DOCKER_DATA_BASEFOLDER:-/opt/docker/data}/homarr/background:/app/public/imgs/background
      - ${DOCKER_DATA_BASEFOLDER:-/opt/docker/data}/homarr/data:/data
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - monitoring_network

  netalertx:
    image: jokobsk/netalertx:latest
    container_name: netalertx
    restart: unless-stopped
    network_mode: host
    environment:
      - TZ=Europe/Rome
      - PORT=20211
      - PUID=1000
      - PGID=1000
    volumes:
      - ${DOCKER_DATA_BASEFOLDER:-/opt/docker/data}/netalertx/config:/app/config
      - ${DOCKER_DATA_BASEFOLDER:-/opt/docker/data}/netalertx/db:/app/db
    ports:
      - 20211:20211 # Web UI (external mapping)
    expose:
      - 20211 # Web UI (internal, for reverse proxy or internal access)

  wyl:
    image: aceberg/watchyourlan:v2
    container_name: watchyourlan
    restart: unless-stopped
    network_mode: host
    environment:
      - TZ=Europe/Rome
      - IFACES=eth0
      - HOST=0.0.0.0
      - PORT=8840
      - TIMEOUT=120
      - SHOUTRRR_URL=
      - THEME=sand
      - COLOR=dark
    volumes:
      - ${DOCKER_DATA_BASEFOLDER:-/opt/docker/data}/wyl2:/data/WatchYourLAN
    ports:
      - 8840:8840 # Web UI (external mapping)
    expose:
      - 8840 # Web UI (internal, for reverse proxy or internal access)

networks:
  monitoring_network:
    name: monitoring_network
    driver: bridge
